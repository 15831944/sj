anon1()'anon1 {
  this
}

anon2()'anon2 {
  this
}

anon3()'anon3 {
  this
}

anon4()'anon4 {
  this
}

array!char([heap]size'i32=, [heap]data'ptr=, [heap]_isGlobal'bool=)'array_char {
  c{

		if (_this->size < 0) {
			exit(-1);
		}

		if (_this->data) {
			_this->_isGlobal = true;
		} else {
			_this->data = (uintptr_t)calloc(_this->size * sizeof(#type(t)), 1);
			if (!_this->data) {
				printf("grow: out of memory\n");
				exit(-1);				
			}
		}
	
}c
  this
}

array_getAt([heap]index'i32:)'char c{

		#forceParent()

		if (index >= _parent->size || index < 0) {
			printf("getAt: out of bounds\n");
			exit(-1);
		}

		#type(t)* p = (#type(t)*)_parent->data;
		#type(t) val = p[index];
##if !#isValue(t)
		if (val == 0) {
			printf("getAt: value is not defined at %d\n", index);
			exit(-1);
		}
##endif
		*_return = val;		
	
}c

array_isEqual([heap]test'array_char:)'bool c{

		#forceParent()
		#include(<string.h>)

		if (_parent->size != test->size) {
			*_return = false;
		}

		*_return = memcmp((void*)_parent->data, (void*)test->data, _parent->size * sizeof(#type(t))) == 0;		
	
}c

array_isLessOrEqual([heap]test'array_char:)'bool c{

		#forceParent()
		#include(<string.h>)

		*_return = memcmp((void*)_parent->data, (void*)test->data, (_parent->size < test->size ? _parent->size : test->size) * sizeof(#type(t))) <= 0;		
	
}c

string([stack]count'i32=, [heap]data'array_char=)'string {
  this
}

string_getAt([heap]index'i32:)'char {
  [heap]array_getAt([stack]this : array_getAt(
    parent: [heap].parentthis.data,
    [heap]index'i32 : this.index
  ))
}

string_isEqual([stack]test'string:)'bool {
  [heap]array_isEqual([stack]this : array_isEqual(
    parent: [heap].parentthis.data,
    [heap]test'array_char : this.data
  ))
}

string_isLessOrEqual([stack]test'string:)'bool {
  [heap]array_isLessOrEqual([stack]this : array_isLessOrEqual(
    parent: [heap].parentthis.data,
    [heap]test'array_char : this.data
  ))
}

global()'void {
  [stack]convert'anon4 : [stack]anon4([stack]this : anon4())
  [stack]random'anon3 : [stack]anon3([stack]this : anon3())
  [stack]parse'anon2 : [stack]anon2([stack]this : anon2())
  [stack]console'anon1 : [stack]anon1([stack]this : anon1())
  [stack]a'string : {
    [stack]string([stack]this : string(
      parent: [stack]this,
      [stack]count'i32 = i,
      [heap]data'array_char = [heap]array!char([heap]this : array!char(
        [heap]size'i32 = i,
        [heap]data'ptr = ,
        [heap]_isGlobal'bool = false
      ))
    ))
  }
  [stack]b'string : {
    [stack]string([stack]this : string(
      parent: [stack]this,
      [stack]count'i32 = i,
      [heap]data'array_char = [heap]array!char([heap]this : array!char(
        [heap]size'i32 = i,
        [heap]data'ptr = ,
        [heap]_isGlobal'bool = false
      ))
    ))
  }
  [stack]c'char : 'a'
  [stack]d'char : '\''
  [stack]e'char : '\n'
  [stack]f'string : {
    [stack]string([stack]this : string(
      parent: [stack]this,
      [stack]count'i32 = i,
      [heap]data'array_char = [heap]array!char([heap]this : array!char(
        [heap]size'i32 = i,
        [heap]data'ptr = ,
        [heap]_isGlobal'bool = false
      ))
    ))
  }
  [heap]h'char : [heap]string_getAt([stack]this : string_getAt(
    parent: [stack]a,
    [heap]index'i32 : 0i
  ))
  [stack]i'bool : h == 'h'
  [heap]j'bool : [heap]string_isEqual([stack]this : string_isEqual(
    parent: [stack]f,
    [stack]test'string : a
  ))
  [heap]k'bool : [heap]string_isLessOrEqual([stack]this : string_isLessOrEqual(
    parent: [stack]f,
    [stack]test'string : a
  ))
  [stack]l'bool : f === a
  void
}

