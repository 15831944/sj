array_getAt(index'i32:)'heap class c{

		int32_t size;
		#retain(i32, size, size);
		uintptr_t data;
		#retain(ptr, data, data);

		if (index >= size || index < 0) {
			printf("getAt: out of bounds\n");
			exit(-1);
		}

		#type(t)* p = (#type(t)*)data;
		#return(t, p[index]);		
	
}c

array_initAt(index'i32:, item'heap class:)'void c{

		int32_t size;
		#retain(i32, size, size);
		uintptr_t data;
		#retain(ptr, data, data);

		if (index >= size || index < 0) {
			printf("setAt: out of bounds %d:%d\n", index, size);
			exit(-1);
		}

		#type(t)* p = (#type(t)*)data;
		#retain(t, p[index], item);
	
}c

global()'void {
  a'heap array_heap_class : heap [array_initAt(
    parent: this,
    index'i32 : this.index,
    item'heap class : this.item
  ), array_initAt(
    parent: this,
    index'i32 : this.index,
    item'heap class : this.item
  ), array_initAt(
    parent: this,
    index'i32 : this.index,
    item'heap class : this.item
  )]
  c'heap class : array_getAt(
    parent: a,
    index'i32 : this.index
  )
  c.x
  void
}

